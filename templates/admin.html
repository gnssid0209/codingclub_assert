<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <style>
    body { font-family: sans-serif; margin: 20px; padding: 0; background: #f9f9f9; }
    h2, h3 { text-align: center; }
    .section { 
        background: #fff; 
        border: 1px solid #ddd; 
        padding: 12px; 
        margin-bottom: 16px; 
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    input, select, button { 
        margin: 5px 0; 
        padding: 10px; 
        font-size: 16px; 
        width: 100%; 
        box-sizing: border-box;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #45a049; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 14px; }
    .status { font-weight: bold; }
    .green { color: green; }
    .red { color: red; }

    /* ë°˜ì‘í˜•: í™”ë©´ì´ 600px ì´í•˜ì¼ ë•Œ */
    @media (max-width: 600px) {
        body { margin: 10px; }
        h2, h3 { font-size: 18px; }
        input, select, button { font-size: 16px; padding: 12px; }
        th, td { font-size: 12px; padding: 6px; }
    }

    /* ë²„íŠ¼ ì—¬ëŸ¬ ê°œ inline ëŒ€ì‹  flex */
    .button-group { display: flex; flex-wrap: wrap; gap: 8px; }
    .button-group form { flex: 1; min-width: 48%; }
  </style>
</head>
<body>
  <h2>ğŸ‘©â€ğŸ’» ê´€ë¦¬ì í˜ì´ì§€</h2>

  <div class="section">
    <h3>ê²Œì„ ìƒíƒœ</h3>
    <p>í˜„ì¬ ê²Œì„:
      {% if game.running %}
        <span class="status green">ì§„í–‰ì¤‘(ë² íŒ… í—ˆìš©)</span>
      {% else %}
        <span class="status red">ëŒ€ê¸°(ë² íŒ… ë¶ˆê°€)</span>
      {% endif %}
    </p>
    <p>ì„¤ì •ëœ ì •ë‹µ: <strong>{{ game.answer if game.answer else "ì„¤ì • ì•ˆë¨" }}</strong></p>

    <div class="button-group">
      <form method="POST">
        <input type="hidden" name="action" value="start">
        <button type="submit">ê²Œì„ ì‹œì‘ (ë°°íŒ… í—ˆìš©)</button>
      </form>

      <form method="POST">
        <input type="hidden" name="action" value="stop_betting">
        <button type="submit">ë°°íŒ… ì¢…ë£Œ</button>
      </form>

      <form method="POST">
        <input type="hidden" name="action" value="set_answer">
        <select name="answer" required>
          <option value="">ì •ë‹µ ì„ íƒ</option>
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <option value="D">D</option>
        </select>
        <button type="submit">ì •ë‹µ ì„¤ì •</button>
      </form>

      <form method="POST">
        <input type="hidden" name="action" value="settle">
        <button type="submit">ì •ì‚°</button>
      </form>
    </div>
  </div>

  <div class="section">
    <h3>ëŒ€ê¸°ì¤‘ì¸ ë°°íŒ…ë“¤</h3>
    {% set bets = game.get('bets', []) %}
    {% if bets %}
      <table>
        <tr><th>í•™ë²ˆ</th><th>ì´ë¦„</th><th>ì„ íƒ</th><th>ë°°íŒ…ê¸ˆ</th><th>ì‹œê°„</th></tr>
        {% for b in bets %}
          <tr>
            <td>{{ b.student_id }}</td>
            <td>{{ b.name }}</td>
            <td>{{ b.choice }}</td>
            <td>{{ b.bet }}G</td>
            <td>{{ b.time }}</td>
          </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>ì ‘ìˆ˜ëœ ë°°íŒ…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

  <div class="section">
    <h3>ìµœê·¼ ì •ì‚° ê²°ê³¼</h3>
    {% set results = game.get('results', {}) %}
    {% if results %}
      <table>
        <tr><th>í•™ë²ˆ</th><th>ê²°ê³¼ ë©”ì‹œì§€</th></tr>
        {% for sid, msg in results.items() %}
          <tr><td>{{ sid }}</td><td>{{ msg }}</td></tr>
        {% endfor %}
      </table>
    {% else %}
      <p>ì •ì‚°ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

  <div class="section">
    <h3>í•™ìƒ ë“±ë¡ (ê¸°ë³¸ 100G ì§€ê¸‰)</h3>
    <form method="POST">
      <input type="hidden" name="action" value="register">
      <input name="student_id" placeholder="í•™ë²ˆ" required>
      <input name="name" placeholder="ì´ë¦„" required>
      <input name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password" required>
      <button type="submit">í•™ìƒ ë“±ë¡</button>
    </form>
  </div>

  <div class="section">
    <h3>í•™ìƒ ëª©ë¡ ë° ë¹„ë°€ë²ˆí˜¸ Â· ì”ì•¡</h3>
    <table>
      <tr><th>í•™ë²ˆ</th><th>ì´ë¦„</th><th>ë¹„ë°€ë²ˆí˜¸</th><th>ë³´ìœ ê¸ˆ</th></tr>
      {% for id, info in users.items() %}
        <tr>
          <td>{{ id }}</td>
          <td>{{ info.name }}</td>
          <td>{{ info.password }}</td>
          <td>{{ balances.get(id, 0) }}G</td>
        </tr>
      {% endfor %}
    </table>
  </div>

  <div class="section">
    <h3>í•™ìƒ ê¸ˆì•¡ ê´€ë¦¬</h3>
    <p>í•™ë²ˆì„ ì„ íƒí•˜ê³  ê¸ˆì•¡ ì…ë ¥ í›„ ì œì¶œ</p>
    <form method="POST">
      <input type="hidden" name="action" value="set_money">
      <select name="target_student_id" required>
        <option value="">í•™ìƒ ì„ íƒ</option>
        {% for id, info in users.items() %}
          <option value="{{ id }}">{{ id }} - {{ info.name }}</option>
        {% endfor %}
      </select>
      <input name="amount" placeholder="ì„¤ì •í•  ê¸ˆì•¡(ì •ìˆ˜)" required>
      <button type="submit">ê¸ˆì•¡ ì„¤ì •</button>
    </form>
  </div>

  {% with messages = get_flashed_messages() %}
  {% if messages %}
    <p style="color: green;">{{ messages[0] }}</p>
  {% endif %}
  {% endwith %}

  <button onclick="window.location.href='/'">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</body>
</html>
